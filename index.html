<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Actividades - Base de Datos II</title>

  <!-- estilo mantenido: fondo negro, acentos verdes/cyan -->
  <style>
    :root{
      --bg:#0f1110;
      --panel:#161616;
      --accent:#00ff88;
      --muted:#c8e6c9;
      --text:#e9efe8;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter, "Segoe UI", Roboto, Arial, sans-serif;background:var(--bg);color:var(--text)}
    header{display:flex;align-items:center;justify-content:space-between;padding:18px 26px;background:#0b0b0b;border-bottom:1px solid rgba(0,255,136,0.06)}
    .header-left img{height:56px;border-radius:6px}
    .header-center{text-align:center}
    .header-center h1{margin:0;font-size:20px;color:var(--accent);text-transform:uppercase}
    .header-center .sub{margin-top:6px;color:var(--muted);font-size:13px}
    nav a{color:var(--accent);text-decoration:none;font-weight:600;margin-left:12px}
    main{max-width:1100px;margin:28px auto;padding:18px}
    .panel{background:var(--panel);padding:18px;border-radius:10px;border:1px solid rgba(0,255,136,0.06)}
    .grid{display:grid;grid-template-columns:repeat(2,1fr);gap:14px;margin-top:18px}
    .card{background:#111;padding:14px;border-radius:10px;border:1px solid rgba(0,255,136,0.06)}
    .card h3{margin:0 0 6px 0;color:var(--accent)}
    .list-files{margin-top:8px;text-align:left}
    .list-files a{display:block;color:var(--accent);text-decoration:none;padding:6px 0}
    .list-files a:hover{color:var(--text);text-decoration:underline}
    .btn {background:var(--accent);color:#000;border:none;padding:8px 12px;border-radius:8px;cursor:pointer;font-weight:700}
    .btn.secondary{background:#ffd27a;color:#000}
    iframe{width:100%;height:640px;border:1px solid rgba(0,255,136,0.06);border-radius:8px;margin-top:12px;background:#000;display:none}
    .note{color:var(--muted);font-size:13px;margin-top:8px}
    @media(max-width:700px){.grid{grid-template-columns:1fr}iframe{height:420px}}
  </style>
</head>
<body>
  <header>
    <div class="header-left">
      <img src="upla.PNG" alt="Logo UPLA" onerror="this.style.display='none'">
    </div>

    <div class="header-center">
      <h1>BASE DE DATOS II</h1>
      <div class="sub">Universidad Peruana Los Andes — Kevin Alfredo Macha Bruno</div>
    </div>

    <nav>
      <a href="#" onclick="show('inicio')">Inicio</a>
      <a href="#" onclick="show('tareas')">Tareas</a>
    </nav>
  </header>

  <main>
    <section id="inicio" class="panel">
      <h2>Bienvenido</h2>
      <p class="note">Selecciona una semana para ver los archivos. El visor abrirá PDFs, imágenes y HTML dentro de la misma página.</p>
    </section>

    <section id="tareas" class="panel" style="display:none">
      <h2>Semanas</h2>
      <div class="grid" id="weeksGrid"></div>
    </section>

    <section id="semana" class="panel" style="display:none">
      <h2 id="weekTitle">Semana</h2>
      <div id="filesArea" class="list-files">Cargando...</div>

      <!-- visor integrado -->
      <iframe id="viewer" src="" sandbox="allow-scripts allow-same-origin"></iframe>

      <div style="margin-top:12px">
        <button id="openRepoBtn" class="btn">Ir al repositorio</button>
        <button onclick="show('tareas')" class="btn secondary">← Volver a Semanas</button>
      </div>
    </section>
  </main>

  <script>
    // === CONFIG - NO CAMBIES si tu repo es KEVIN43287/Actividades/branch main ===
    const USER = "KEVIN43287";
    const REPO = "Actividades";
    const BRANCH = "main";
    const TOTAL_WEEKS = 16; // si tienes más, cambia este número
    // ===============================================================

    const weeksGrid = document.getElementById('weeksGrid');
    const filesArea = document.getElementById('filesArea');
    const viewer = document.getElementById('viewer');
    const weekTitle = document.getElementById('weekTitle');
    const openRepoBtn = document.getElementById('openRepoBtn');

    // Render tarjetas de semanas
    for (let i = 1; i <= TOTAL_WEEKS; i++) {
      const card = document.createElement('div');
      card.className = 'card';
      card.innerHTML = `<h3>Semana ${i}</h3>
        <div class="note">Haz clic para listar archivos</div>
        <div style="margin-top:10px">
          <button class="btn" onclick="openWeek(${i})">Abrir Semana ${i}</button>
        </div>`;
      weeksGrid.appendChild(card);
    }

    function show(sectionId){
      document.querySelectorAll('main > section').forEach(s => s.style.display = 'none');
      document.getElementById(sectionId).style.display = 'block';
      window.scrollTo({top:0,behavior:'smooth'});
    }

    // Abrir vista de la semana: consulta GitHub API y lista archivos
    async function openWeek(n){
      show('semana');
      weekTitle.textContent = `Semana ${n}`;
      filesArea.innerHTML = 'Comprobando carpeta en el repositorio...';
      viewer.style.display = 'none';
      viewer.src = '';

      const folderPath = `Semana${n}`; // OBS: respeta mayúscula exacta como en tu repo
      const apiUrl = `https://api.github.com/repos/${USER}/${REPO}/contents/${encodeURIComponent(folderPath)}?ref=${BRANCH}`;

      try {
        const res = await fetch(apiUrl);
        if (res.status === 404) {
          filesArea.innerHTML = `<p class="note">No se encontró la carpeta <strong>${folderPath}</strong>. Revisa nombre exacto o branch.</p>`;
          openRepoBtn.onclick = () => window.open(`https://github.com/${USER}/${REPO}/tree/${BRANCH}`, '_blank');
          return;
        }
        if (!res.ok) {
          filesArea.innerHTML = `<p class="note">Error al consultar GitHub API (status ${res.status}).</p>`;
          return;
        }

        const items = await res.json(); // array con {name,path,download_url,type,...}
        if (!Array.isArray(items) || items.length === 0) {
          filesArea.innerHTML = `<p class="note">La carpeta existe pero está vacía.</p>`;
          openRepoBtn.onclick = () => window.open(`https://github.com/${USER}/${REPO}/tree/${BRANCH}/` + folderPath, '_blank');
          return;
        }

        // ordenar: index.html primero, luego por nombre
        items.sort((a,b)=>{
          if (a.name.toLowerCase() === 'index.html') return -1;
          return a.name.localeCompare(b.name);
        });

        // construir lista visible
        filesArea.innerHTML = '';
        let firstViewable = null;
        items.forEach(it => {
          if (it.type !== 'file') return;
          const name = it.name;
          const download = it.download_url || `https://raw.githubusercontent.com/${USER}/${REPO}/${BRANCH}/${it.path}`;
          const a = document.createElement('a');
          a.href = '#';
          a.textContent = name;
          a.onclick = (e) => { e.preventDefault(); viewFile(name, download, folderPath); };
          filesArea.appendChild(a);

          // elegimos el primer archivo viewable (pdf/html/img) como carga inicial
          const ext = name.split('.').pop().toLowerCase();
          if (!firstViewable && ['pdf','html','htm','png','jpg','jpeg','gif','svg','txt','md','docx','xlsx','pptx'].includes(ext)) {
            firstViewable = {name, download};
          }
        });

        if (!firstViewable) {
          filesArea.innerHTML += '<p class="note">No se encontraron archivos visualizables automáticamente.</p>';
        } else {
          // mostrar el primero automáticamente
          viewFile(firstViewable.name, firstViewable.download, folderPath);
        }

        openRepoBtn.onclick = () => window.open(`https://github.com/${USER}/${REPO}/tree/${BRANCH}/${folderPath}`, '_blank');

      } catch (err) {
        console.error(err);
        filesArea.innerHTML = `<p class="note">Error de red o CORS al llamar la API.</p>`;
      }
    }

    // Muestra el archivo en iframe o usa Google Viewer para Office
    function viewFile(name, rawUrl, folderPath) {
      const ext = name.split('.').pop().toLowerCase();

      // Si es HTML preferimos la URL pública de GitHub Pages (si existe)
      if (ext === 'html' || ext === 'htm') {
        const pageUrl = `https://${USER}.github.io/${REPO}/${folderPath}/${encodeURIComponent(name)}`;
        viewer.src = pageUrl;
        viewer.style.display = 'block';
        viewer.scrollIntoView({behavior:'smooth'});
        return;
      }

      // imágenes / pdf / txt / md: raw.githubusercontent funciona bien en iframe
      if (['pdf','png','jpg','jpeg','gif','svg','txt','md'].includes(ext)) {
        viewer.src = rawUrl;
        viewer.style.display = 'block';
        viewer.scrollIntoView({behavior:'smooth'});
        return;
      }

      // Office (docx, xlsx, pptx) - usamos Google Docs viewer embebido
      if (['docx','xlsx','pptx','doc','xls','ppt'].includes(ext)) {
        const g = `https://docs.google.com/gview?url=${encodeURIComponent(rawUrl)}&embedded=true`;
        viewer.src = g;
        viewer.style.display = 'block';
        viewer.scrollIntoView({behavior:'smooth'});
        return;
      }

      // Por defecto: intentar raw
      viewer.src = rawUrl;
      viewer.style.display = 'block';
      viewer.scrollIntoView({behavior:'smooth'});
    }

    // Al cargar: mostrar la vista Tareas
    show('tareas');

  </script>
</body>
</html>
