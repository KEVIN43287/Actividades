<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BASE DE DATOS II - Actividades</title>
<style>
  body {
    margin: 0;
    background-color: #000;
    color: #e0ffe0;
    font-family: "Poppins", sans-serif;
  }
  header {
    background-color: #0c0c0c;
    color: #00ff99;
    padding: 15px;
    text-align: center;
    border-bottom: 2px solid #00ff99;
  }
  header h1 {
    margin: 0;
  }
  header p {
    margin: 4px 0;
    color: #b3ffcc;
  }
  main {
    padding: 20px;
    text-align: center;
  }
  .weeks {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
    gap: 12px;
    margin-top: 20px;
  }
  button {
    background-color: #00ff99;
    border: none;
    color: #000;
    padding: 8px 14px;
    border-radius: 6px;
    font-weight: 700;
    cursor: pointer;
  }
  button:hover {
    background-color: #aaffcc;
  }
  a {
    color: #00ff99;
    text-decoration: none;
  }
  a:hover {
    text-decoration: underline;
  }
  iframe {
    width: 100%;
    height: 600px;
    border: none;
    border-radius: 8px;
    margin-top: 10px;
    display: none;
  }
</style>
</head>
<body>
  <header>
    <h1>BASE DE DATOS II</h1>
    <p>Universidad Peruana Los Andes - Kevin Alfredo Macha Bruno</p>
  </header>

  <main>
    <h2>Selecciona una Semana</h2>
    <div class="weeks" id="weeks"></div>

    <div id="viewerSection" style="display:none;">
      <h2 id="weekTitle"></h2>
      <div id="fileList"></div>
      <iframe id="viewer"></iframe>
      <div style="margin-top:12px;">
        <button id="repoBtn">Ir al repositorio</button>
        <button onclick="backToWeeks()">Volver</button>
      </div>
    </div>
  </main>

  <script>
    const USER = "KEVIN43287";
    const REPO = "Actividades";
    const TOTAL_WEEKS = 16;
    const weeksDiv = document.getElementById("weeks");
    const viewerSection = document.getElementById("viewerSection");
    const fileList = document.getElementById("fileList");
    const viewer = document.getElementById("viewer");
    const weekTitle = document.getElementById("weekTitle");
    const repoBtn = document.getElementById("repoBtn");

    // Crear botones de semanas
    for (let i = 1; i <= TOTAL_WEEKS; i++) {
      const btn = document.createElement("button");
      btn.textContent = `Semana ${i}`;
      btn.onclick = () => openWeek(i);
      weeksDiv.appendChild(btn);
    }

    function backToWeeks() {
      viewerSection.style.display = "none";
      weeksDiv.style.display = "grid";
    }

    function openWeek(n) {
      const folder = `Semana${n}`;
      const folderURL = `https://${USER}.github.io/${REPO}/${folder}/`;
      repoBtn.onclick = () => window.open(`https://github.com/${USER}/${REPO}/tree/main/${folder}`, "_blank");

      weekTitle.textContent = `Semana ${n}`;
      fileList.innerHTML = "Cargando archivos...";
      weeksDiv.style.display = "none";
      viewerSection.style.display = "block";
      viewer.style.display = "none";

      fetch(folderURL)
        .then(r => r.text())
        .then(html => {
          const parser = new DOMParser();
          const doc = parser.parseFromString(html, "text/html");
          const links = [...doc.querySelectorAll("a")];
          const files = links
            .map(a => a.getAttribute("href"))
            .filter(h => h && !h.includes(".gitkeep") && !h.startsWith("?") && !h.startsWith("/"));

          if (files.length === 0) {
            fileList.innerHTML = `<p>No hay archivos en esta semana.</p>`;
            return;
          }

          fileList.innerHTML = "";
          files.forEach(name => {
            const link = document.createElement("a");
            link.href = "#";
            link.textContent = name;
            link.onclick = (e) => {
              e.preventDefault();
              viewFile(folder, name);
            };
            fileList.appendChild(link);
            fileList.appendChild(document.createElement("br"));
          });
        })
        .catch(() => {
          fileList.innerHTML = `<p>Error al cargar los archivos. Asegúrate de que la carpeta "${folder}" esté publicada.</p>`;
        });
    }

    function viewFile(folder, name) {
      const url = `https://${USER}.github.io/${REPO}/${folder}/${name}`;
      const ext = name.split(".").pop().toLowerCase();

      if (["pdf", "png", "jpg", "jpeg", "gif", "svg", "html", "htm"].includes(ext)) {
        viewer.src = url;
      } else if (["docx", "pptx", "xlsx"].includes(ext)) {
        viewer.src = `https://docs.google.com/gview?url=${encodeURIComponent(url)}&embedded=true`;
      } else {
        viewer.src = url;
      }
      viewer.style.display = "block";
    }
  </script>
</body>
</html>
